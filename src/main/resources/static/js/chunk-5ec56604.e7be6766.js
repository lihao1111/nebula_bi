(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ec56604"],{"0518":function(e,t,a){},"0a0d":function(e,t,a){e.exports=a("e829")},"0a90":function(e,t,a){var i=a("63b6"),n=a("10ff");i(i.G+i.F*(parseFloat!=n),{parseFloat:n})},"10ff":function(e,t,a){var i=a("e53d").parseFloat,n=a("a1ce").trim;e.exports=1/i(a("e692")+"-0")!==-1/0?function(e){var t=n(String(e),3),a=i(t);return 0===a&&"-"==t.charAt(0)?-0:a}:i},"15f7":function(e,t,a){"use strict";var i=a("0518"),n=a.n(i);n.a},"273d":function(e,t,a){},"2f21":function(e,t,a){"use strict";var i=a("79e5");e.exports=function(e,t){return!!e&&i(function(){t?e.call(null,function(){},1):e.call(null)})}},"2f37":function(e,t,a){var i=a("63b6");i(i.S,"Date",{now:function(){return(new Date).getTime()}})},"55dd":function(e,t,a){"use strict";var i=a("5ca1"),n=a("d8e8"),r=a("4bf8"),o=a("79e5"),l=[].sort,s=[1,2,3];i(i.P+i.F*(o(function(){s.sort(void 0)})||!o(function(){s.sort(null)})||!a("2f21")(l)),"Array",{sort:function(e){return void 0===e?l.call(r(this)):l.call(r(this),n(e))}})},"59ad":function(e,t,a){e.exports=a("7be7")},"5d6b":function(e,t,a){var i=a("e53d").parseInt,n=a("a1ce").trim,r=a("e692"),o=/^[-+]?0[xX]/;e.exports=8!==i(r+"08")||22!==i(r+"0x16")?function(e,t){var a=n(String(e),3);return i(a,t>>>0||(o.test(a)?16:10))}:i},7445:function(e,t,a){var i=a("63b6"),n=a("5d6b");i(i.G+i.F*(parseInt!=n),{parseInt:n})},"7be7":function(e,t,a){a("0a90"),e.exports=a("584a").parseFloat},"7f7f":function(e,t,a){var i=a("86cc").f,n=Function.prototype,r=/^\s*function ([^ (]*)/,o="name";o in n||a("9e1e")&&i(n,o,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(e){return""}}})},"88ca":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"chart-container"},[a("el-col",{staticClass:"toolbar1",staticStyle:{height:"50px","padding-left":"10px","padding-top":"5px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",[a("div",{staticClass:"block"},[a("el-date-picker",{staticStyle:{width:"220px"},attrs:{type:"daterange","value-format":"yyyy-MM-dd",size:"small",align:"center","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.queryDate,callback:function(t){e.queryDate=t},expression:"queryDate"}})],1)]),a("el-form-item",{attrs:{label:"内容类型："}},[a("el-select",{staticStyle:{width:"160px"},attrs:{size:"small",clearable:"",placeholder:"请选择内容类型"},model:{value:e.contentType,callback:function(t){e.contentType=t},expression:"contentType"}},e._l(e.typeMapArr,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),a("el-form-item",{attrs:{label:"所属CP："}},[a("el-select",{staticStyle:{width:"160px"},attrs:{size:"small",clearable:"",placeholder:"请选择CP"},model:{value:e.contentCP,callback:function(t){e.contentCP=t},expression:"contentCP"}},e._l(e.cps,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}),1)],1),a("el-form-item",{attrs:{label:"内容名称："}},[a("el-input",{staticStyle:{width:"180px"},attrs:{size:"small"},model:{value:e.contentKey,callback:function(t){e.contentKey=t},expression:"contentKey"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary ",size:"small",icon:"el-icon-search"},on:{click:e.getPlayCount}},[e._v("查询")])],1)],1)],1),a("el-col",{staticStyle:{"padding-top":"20px","padding-right":"15px"},attrs:{span:5}},[a("el-card",{staticStyle:{height:"320px","background-color":"#6EAF91",color:"#fff","text-align":"center"},attrs:{shadow:"always"}},[a("div",[a("label",{staticStyle:{display:"block","padding-top":"40px","font-weight":"bold","font-size":"30px","padding-bottom":"5px"}},[e._v("\n          "+e._s(e._f("formaterNumber")(e.sumPlayCount))+"\n        ")]),a("em",{staticStyle:{padding:"0px 10px","border-radius":"5px","box-shadow":"rgba(255,255,255,.5) 0px 0px 10px 5px"}},[e._v("总播放次数")])]),a("label",{staticStyle:{display:"block","padding-top":"70px","font-weight":"bold","font-size":"30px","padding-bottom":"5px"}},[e._v("\n        "+e._s(e.avgCount.toFixed(2))+"\n      ")]),a("em",{staticStyle:{padding:"0px 10px","border-radius":"5px","box-shadow":"rgba(255,255,255,.5) 0px 0px 10px 5px"}},[e._v("人均播放次数")])])],1),a("el-col",{staticStyle:{"padding-top":"20px","padding-right":"15px"},attrs:{span:11}},[a("div",{staticClass:"likeCard",attrs:{id:"playCountPre_CP"}})]),a("el-col",{staticStyle:{"padding-top":"20px"},attrs:{span:8}},[a("div",{staticClass:"likeCard",attrs:{id:"playCountPre_TYPE"}})]),a("el-col",{attrs:{span:24}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.chartLoading,expression:"chartLoading"}],staticStyle:{width:"100%",height:"550px"},attrs:{id:"playCountTop"}})]),a("div",{staticStyle:{padding:"0px 10px"}},[a("el-col",{staticStyle:{"margin-top":"10px",height:"40px","line-height":"40px","background-color":"rgba(17, 146, 175, 0.18)"},attrs:{span:24}},[a("span",{staticStyle:{padding:"10px",color:"#606266"}},[e._v("详细数据"),a("i",{staticClass:"el-icon-info"})]),a("el-link",{staticStyle:{float:"right","margin-right":"10px","font-weight":"bold"},attrs:{type:"primary",underline:!1,icon:"el-icon-download"},on:{click:e.handleExport}},[e._v("\n        导出数据\n      ")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tPlayTimeList.slice((e.curpage-1)*e.pageSize,e.curpage*e.pageSize),"highlight-current-row":"","header-cell-style":{"background-color":"#f2f2f2",color:"#3a8ee6","border-bottom":"1px #f2f2f2 solid"}}},[a("el-table-column",{attrs:{prop:"day",sortable:"",label:"日期",align:"left"}}),a("el-table-column",{attrs:{prop:"media_id",label:"内容ID",align:"left"}}),a("el-table-column",{attrs:{prop:"media_name",label:"内容名称",align:"left"}}),a("el-table-column",{attrs:{prop:"media_type",label:"内容类型",align:"left",formatter:e.formaterText}}),a("el-table-column",{attrs:{prop:"cp_name",label:"提供方名称",align:"left"}}),a("el-table-column",{attrs:{prop:"validCount",sortable:"",label:"有效播放次数",align:"left"}}),a("el-table-column",{attrs:{label:"详情",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-search"},on:{click:function(a){return e.handleDetail(t.$index,t.row)}}},[e._v("完整度\n          ")])]}}])})],1),a("el-col",{attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{background:"","page-size":e.pageSize,total:e.totalSize,layout:"prev, pager, next"},on:{"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:"影片完整度",visible:e.dialogPerVisible},on:{"update:visible":function(t){e.dialogPerVisible=t}}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("span",[e._v("影片："),a("b",{staticStyle:{color:"#1d8ce0"}},[e._v(e._s(e.chooseMediaName))])])]),a("div",{ref:"playCountPerDiv",staticStyle:{height:"500px"},attrs:{id:"playCountPer"}})])],1)},n=[],r=(a("7f7f"),a("55dd"),a("59ad")),o=a.n(r),l=a("e814"),s=a.n(l),c=a("0a0d"),p=a.n(c),u=a("4ec3"),d=a("313e"),m=a.n(d),h={data:function(){return{cps:"",contentType:"",contentCP:"",contentKey:"",queryDate:[new Date((new Date).getTime()-6048e5),new Date((new Date).getTime()-864e5)],pickerOptions:{disabledDate:function(e){return e.getTime()>p()()},shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}}]},chartLoading:!1,tApp:"",tPlayTimeList:[],typeMap:{1:"纯音乐",2:"视频音乐",3:"电影",4:"电视剧"},typeMapArr:[{id:1,name:"纯音乐"},{id:2,name:"视频音乐"},{id:3,name:"电影"},{id:4,name:"电视剧"}],totalSize:0,curpage:1,pageSize:15,sumPlayCount:0,avgCount:0,playTimePrecCP:[],playTimePrecTYPE:[],playTimeTop:[],dialogPerVisible:!1,chooseMediaName:"",chooseMediaPer:{},mediaPerArr:["per_20","per_20_50","per_50_80","per_80"]}},methods:{handleDetail:function(e,t){var a=this;this.chooseMediaName=t.media_name,Object(u["x"])({platFormId:this.tApp.id,mediaId:t.media_id,day:t.day}).then(function(e){var t=e.businessCode,i=e.resultSet;return"success"!==t?(a.$message({message:"数据完整度加载失败，请联系管理员！",type:"error"}),!1):0===i.length?(a.$message({message:"未加载到完整度数据！",type:"warning"}),!1):(a.chooseMediaPer=i[0],a.dialogPerVisible=!0,void a.drawPerMedia())})},drawPerMedia:function(){var e=this,t=[],a=[];for(var i in this.chooseMediaPer){var n="";if(-1!=this.mediaPerArr.indexOf(i)){switch(i){case"per_20":n="完整度20%";break;case"per_20_50":n="完整度20%_50%";break;case"per_50_80":n="完整度50%_80%";break;case"per_80":n="完整度80%";break}a.push(n),t.push({name:n,value:s()(this.chooseMediaPer[i])})}}var r={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",top:5,left:10,data:a},series:[{name:"观看完整度",type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:t}]};this.$nextTick(function(){var t=m.a.init(e.$refs.playCountPerDiv);t.clear(),t.setOption(r),window.onresize=t.resize})},handleCurrentChange:function(e){this.curpage=e},formaterText:function(e,t,a){return this.typeMap[a]},getPlayCount:function(){var e=this;if(!this.queryDate)return this.$message({showClose:!0,message:"请选择查询日期范围！",type:"warning"}),!1;if(this.queryDate[1]<this.queryDate[0])return this.$message({showClose:!0,message:"结束日期必须大于开始日期！",type:"error"}),!1;var t=(new Date(this.queryDate[1]).getTime()-new Date(this.queryDate[0]).getTime())/864e5;if(t>31)return this.$message({showClose:!0,message:"日期范围过大，不建议操作",type:"warning"}),!1;this.chartLoading=!0,Object(u["I"])({startDate:this.queryDate[0],endDate:this.queryDate[1],platFormId:this.tApp.id,contentType:this.contentType,contentCP:this.contentCP,contentKey:this.contentKey}).then(function(t){var a=t.businessCode,i=t.resultSet;if(e.chartLoading=!1,"unauthenticated"===a)return e.$message({message:"未授权，请联系管理员！",type:"error"}),!1;if("success"!==a)e.$message({message:"有效播放次数加载失败，请联系管理员！",type:"error"});else{e.tPlayTimeList=i,0==e.tPlayTimeList.length&&e.$notify.info({title:"警告",message:"未加载到影片播放数据！",type:"warning"}),e.totalSize=e.tPlayTimeList.length,e.curpage=1,e.sumPlayCount=0,e.avgCount=0;var n={},r={},l={};e.tPlayTimeList.forEach(function(t){var a=s()(t.validCount),i=t.media_name,c=t.cp_name,p=t.media_type;e.sumPlayCount+=a,e.avgCount+=o()(t.avgCount),null==n[c]&&(n[c]=0),n[c]+=a,null==r[p]&&(r[p]=0),r[p]+=a,null==l[i]&&(l[i]=0),l[i]+=a}),e.tPlayTimeList.length>0&&(e.avgCount=e.avgCount/e.tPlayTimeList.length),e.drawPerCPChart(n),e.drawPerTypeChart(r),e.drawTOPChart(l)}})},drawPerCPChart:function(e){this.playTimePrecCP=[];var t=[];for(var a in e)"null"===a?(t.push("其他"),this.playTimePrecCP.push({name:"其他",value:e[a]})):(t.push(a),this.playTimePrecCP.push({name:a,value:e[a]}));var i={border:!1,legend:{orient:"vertical",x:"left",top:5,left:10,data:t},grid:{bottom:"5%",containLabel:!0},series:[{name:"CP名称",type:"pie",radius:"55%",center:["60%","55%"],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:this.playTimePrecCP}],tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"}},n=m.a.init(document.getElementById("playCountPre_CP"));n.clear(),n.setOption(i),window.onresize=n.resize},drawPerTypeChart:function(e){this.playTimePrecTYPE=[];var t=[];for(var a in e)"null"===a?(t.push("其他"),this.playTimePrecTYPE.push({name:"其他",value:e[a]})):(t.push(this.typeMap[a]),this.playTimePrecTYPE.push({name:this.typeMap[a],value:e[a]}));var i={border:!1,legend:{orient:"vertical",x:"left",top:5,left:10,data:t},grid:{bottom:"5%",containLabel:!0},series:[{name:"内容类型",type:"pie",radius:"55%",center:["50%","55%"],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:this.playTimePrecTYPE}],color:["#749F83","#D48265","#61A0A8"],tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"}},n=m.a.init(document.getElementById("playCountPre_TYPE"));n.clear(),n.setOption(i),window.onresize=n.resize},drawTOPChart:function(e){for(var t in this.playTimeTop=[],e)this.playTimeTop.push({name:t,value:e[t]});this.playTimeTop.sort(this.Compare("value")),this.playTimeTop=this.playTimeTop.length>20?this.playTimeTop.slice(0,20):this.playTimeTop;var a=[],i=[];this.playTimeTop.forEach(function(e){"null"===e.name?a.push("其他"):a.push(e.name),i.push(e.value)});var n={color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:[{type:"category",data:a,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"有效播放次数",type:"bar",barWidth:"60%",data:i,itemStyle:{normal:{label:{show:!0,position:"top",textStyle:{color:"black",fontSize:16}}}}}]},r=m.a.init(document.getElementById("playCountTop"));r.clear(),r.setOption(n),window.onresize=r.resize},Compare:function(e){return function(t,a){var i=t[e],n=a[e];return i<n?1:i>n?-1:0}},handleExport:function(){var e=this;if(0===this.tPlayTimeList.length)return this.$message({message:"表格无数据，导出异常！",type:"warning"}),!1;Promise.all([a.e("chunk-61154d27"),a.e("chunk-2d0ba6db")]).then(function(){var t=a("39a0"),i=t.exportExcel,n=["日期","内容ID","内容名称","内容类型","提供方名称","有效次数"],r=["day","media_id","media_name","media_type","cp_name","validCount"],o=e.tPlayTimeList,l=e.formatJson(r,o);i(n,l,"有效次数excel")}.bind(null,a)).catch(a.oe)},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return t[e]})})},getAllCPS:function(){var e=this;Object(u["o"])().then(function(t){var a=t.businessCode,i=t.resultSet;"success"!==a?e.$message({message:"CP数据加载失败，请联系管理员！",type:"error"}):e.cps=i})}},created:function(){this.tApp=JSON.parse(sessionStorage.getItem("tApp")),this.getAllCPS(),this.getPlayCount()},mounted:function(){},updated:function(){}},f=h,g=(a("c328"),a("15f7"),a("2877")),y=Object(g["a"])(f,i,n,!1,null,"15c1d505",null);t["default"]=y.exports},a1ce:function(e,t,a){var i=a("63b6"),n=a("25eb"),r=a("294c"),o=a("e692"),l="["+o+"]",s="​",c=RegExp("^"+l+l+"*"),p=RegExp(l+l+"*$"),u=function(e,t,a){var n={},l=r(function(){return!!o[e]()||s[e]()!=s}),c=n[e]=l?t(d):o[e];a&&(n[a]=c),i(i.P+i.F*l,"String",n)},d=u.trim=function(e,t){return e=String(n(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(p,"")),e};e.exports=u},b9e9:function(e,t,a){a("7445"),e.exports=a("584a").parseInt},c328:function(e,t,a){"use strict";var i=a("273d"),n=a.n(i);n.a},e692:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},e814:function(e,t,a){e.exports=a("b9e9")},e829:function(e,t,a){a("2f37"),e.exports=a("584a").Date.now}}]);